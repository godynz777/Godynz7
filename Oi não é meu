--// CONFIG
local espColorBeast = Color3.fromRGB(255, 0, 0)
local espColorPC = Color3.fromRGB(0, 170, 255)
local refreshRate = 0.2

--// SERVIÇOS
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

--// GUI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "ESP_UI"

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 220, 0, 120)
MainFrame.Position = UDim2.new(0, 50, 0, 100)
MainFrame.BackgroundColor3 = Color3.fromRGB(60, 0, 90)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true

local UIStroke = Instance.new("UIStroke", MainFrame)
UIStroke.Thickness = 2
UIStroke.Color = Color3.fromRGB(160, 0, 255)

local Title = Instance.new("TextLabel", MainFrame)
Title.Text = "ESP Panel"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16

local ToggleESP = Instance.new("TextButton", MainFrame)
ToggleESP.Text = "Ativar ESP"
ToggleESP.Size = UDim2.new(1, -20, 0, 30)
ToggleESP.Position = UDim2.new(0, 10, 0, 40)
ToggleESP.BackgroundColor3 = Color3.fromRGB(100, 0, 150)
ToggleESP.TextColor3 = Color3.new(1, 1, 1)
ToggleESP.Font = Enum.Font.Gotham
ToggleESP.TextSize = 14

local CloseButton = Instance.new("TextButton", MainFrame)
CloseButton.Text = "✕"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(120, 0, 180)
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 20

local OpenButton = Instance.new("TextButton", ScreenGui)
OpenButton.Text = "⮞"
OpenButton.Size = UDim2.new(0, 30, 0, 30)
OpenButton.Position = UDim2.new(0, 10, 0, 10)
OpenButton.BackgroundColor3 = Color3.fromRGB(80, 0, 120)
OpenButton.TextColor3 = Color3.new(1, 1, 1)
OpenButton.Font = Enum.Font.GothamBold
OpenButton.TextSize = 20
OpenButton.Visible = false

--// ESTADO
local ESP_ENABLED = false
local ESP_OBJECTS = {}

--// AURA
local function createAura(part, color)
	local highlight = Instance.new("Highlight")
	highlight.Adornee = part.Parent
	highlight.FillColor = color
	highlight.FillTransparency = 0.5
	highlight.OutlineTransparency = 1
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.Parent = part
	table.insert(ESP_OBJECTS, highlight)
end

--// LIMPAR ESP
local function clearESP()
	for _, v in pairs(ESP_OBJECTS) do
		if v and v.Parent then
			v:Destroy()
		end
	end
	ESP_OBJECTS = {}
end

--// ATUALIZAÇÃO
local function updateESP()
	clearESP()
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local gui = player:FindFirstChild("PlayerGui")
			if gui and gui:FindFirstChild("BeastIcon") then
				createAura(player.Character.HumanoidRootPart, espColorBeast)
			end
		end
	end
	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and obj.Name:lower():find("computer") then
			local part = obj:FindFirstChildWhichIsA("BasePart")
			if part then
				createAura(part, espColorPC)
			end
		end
	end
end

--// LOOP
task.spawn(function()
	while true do
		if ESP_ENABLED then
			pcall(updateESP)
		else
			clearESP()
		end
		task.wait(refreshRate)
	end
end)

--// BOTÕES
ToggleESP.MouseButton1Click:Connect(function()
	ESP_ENABLED = not ESP_ENABLED
	ToggleESP.Text = ESP_ENABLED and "Desativar ESP" or "Ativar ESP"
end)

-- Minimizar com animação
local Minimized = false
local FullSize = UDim2.new(0, 220, 0, 120)
local MinSize = UDim2.new(0, 220, 0, 30)

CloseButton.MouseButton1Click:Connect(function()
	Minimized = true
	local tween = TweenService:Create(MainFrame, TweenInfo.new(0.25), {Size = MinSize})
	tween:Play()
	for _, child in pairs(MainFrame:GetChildren()) do
		if child ~= Title and child ~= CloseButton then
			child.Visible = false
		end
	end
	OpenButton.Visible = true
end)

OpenButton.MouseButton1Click:Connect(function()
	Minimized = false
	local tween = TweenService:Create(MainFrame, TweenInfo.new(0.25), {Size = FullSize})
	tween:Play()
	for _, child in pairs(MainFrame:GetChildren()) do
		child.Visible = true
	end
	OpenButton.Visible = false
end)
