--// Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

--// GUI Setup
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "ESP_GUI"

local Frame = Instance.new("Frame", ScreenGui)
Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Frame.BorderSizePixel = 2
Frame.Position = UDim2.new(0, 20, 0, 60)
Frame.Size = UDim2.new(0, 220, 0, 40)
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel", Frame)
Title.Text = "ESP Painel"
Title.TextColor3 = Color3.fromRGB(0, 255, 0)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 0.5, 0)
Title.Font = Enum.Font.SourceSansBold
Title.TextScaled = true

local Toggle = Instance.new("TextButton", Frame)
Toggle.Text = "Toggle ESP"
Toggle.Size = UDim2.new(1, 0, 0.5, 0)
Toggle.Position = UDim2.new(0, 0, 0.5, 0)
Toggle.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Toggle.TextColor3 = Color3.fromRGB(0, 255, 0)
Toggle.Font = Enum.Font.SourceSans
Toggle.TextScaled = true

local OpenButton = Instance.new("TextButton", ScreenGui)
OpenButton.Text = "☰"
OpenButton.Size = UDim2.new(0, 40, 0, 40)
OpenButton.Position = UDim2.new(0, 10, 0, 10)
OpenButton.Visible = false
OpenButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
OpenButton.TextColor3 = Color3.new(0, 0, 0)
OpenButton.Font = Enum.Font.SourceSansBold
OpenButton.TextScaled = true

Toggle.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if not espEnabled then clearESP() end
end)

Frame.MouseLeave:Connect(function()
    Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
end)

Frame.MouseEnter:Connect(function()
    Frame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
end)

-- Minimizar / Restaurar
local CloseButton = Instance.new("TextButton", Frame)
CloseButton.Text = "X"
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -25, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
CloseButton.TextColor3 = Color3.fromRGB(255, 0, 0)
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.TextScaled = true

CloseButton.MouseButton1Click:Connect(function()
    Frame.Visible = false
    OpenButton.Visible = true
end)

OpenButton.MouseButton1Click:Connect(function()
    Frame.Visible = true
    OpenButton.Visible = false
end)

--// ESP Setup
local espEnabled = true
local espObjects = {}
local espColorBeast = Color3.fromRGB(255, 0, 0)
local espColorComputer = Color3.fromRGB(0, 150, 255)

function createHighlight(target, color)
    if target:FindFirstChild("ESP_Highlight") then return end
    local hl = Instance.new("Highlight")
    hl.Name = "ESP_Highlight"
    hl.FillColor = color
    hl.OutlineColor = Color3.new(0, 0, 0)
    hl.FillTransparency = 0.5
    hl.OutlineTransparency = 0
    hl.Adornee = target
    hl.Parent = target
    table.insert(espObjects, hl)
end

function clearESP()
    for _, esp in ipairs(espObjects) do
        if esp and esp.Parent then
            esp:Destroy()
        end
    end
    espObjects = {}
end

--// Identificar a Beast corretamente
function isBeast(player)
    local tag = player:FindFirstChild("PlayerGui")
    if not tag then return false end

    -- Aqui você pode trocar "BeastIcon" por qualquer outro nome real do GUI
    return tag:FindFirstChild("BeastIcon") or tag:FindFirstChild("Beast") or false
end

--// ESP Atualização
RunService.RenderStepped:Connect(function()
    if not espEnabled then return end
    clearESP()

    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            if isBeast(p) then
                createHighlight(p.Character, espColorBeast)
            end
        end
    end

    -- Detectar computadores
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj.Name:lower():find("computer") and obj:IsA("Model") then
            local part = obj:FindFirstChildWhichIsA("BasePart")
            if part and not part:FindFirstChild("ESP_Highlight") then
                createHighlight(part, espColorComputer)
            end
        end
    end
end)
